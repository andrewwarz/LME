module nix_container_runtime 1.0;

require {
    type bin_t;
    type usr_t;
    type unconfined_t;
    type unconfined_exec_t;
    class file { execute execute_no_trans read getattr };
    class dir { search getattr };
}

#============= Nix Container Runtime SELinux Policy =============
# Allows Nix-installed container runtime tools (podman, conmon, runc, crun, etc.)
# to work properly on SELinux-enforced systems by providing necessary contexts
# and permissions for binaries installed in non-standard /nix/store paths

# Allow unconfined domain to execute files from /nix/store paths
allow unconfined_t bin_t:file { execute execute_no_trans read getattr };
allow unconfined_t usr_t:dir { search getattr };
allow unconfined_t bin_t:dir { search getattr };