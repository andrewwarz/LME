<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title> Logging Made Easy </title>
    <meta property="og:title" content="LME">
    <meta property="og:locale" content="en_US">
    <meta name="description" content="Logging Made Easy">

    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="wrapper">
        <header>
            <div class="side-nav">
                <img class="logo" src="pages/assets/imgs/lme-image.png" alt="Logo">
                <div class="version">v2.0</div>
                <div class="nav-links">
                    <a href="index.html">Overview</a>
                    <a class="active" href="installation-overview.html">Installation</a>
                    <a href="documentation.html">Documentation</a>
                </div>
            </div>
        </header>
        <main>
            <h1>Downloading and Installing LME</h1>
                <p>
                    LME now includes Ansible scripts to automate the installation process, making deployment faster and more efficient. Our installation guide video is coming soon. When the video is released, you will find the link to it here. These steps will guide you through setting up LME on your Ubuntu 22.04 server, ensuring a smooth and
                    secure
                    deployment.
                </p>
                <p>
                    <b>Note:</b> LME has been extensively tested on Ubuntu 22.04. While it can run on other Unix-like systems, we recommend sticking with Ubuntu 22.04 for the best experience.
                </p>
                <p>
                    <b>Please ensure you follow all the configuration steps required below.</b>
                </p>
                <p>
                    <b>Upgrading</b>: If you are upgrading from an older version of LME to LME 2.0, please see our <a href="upgrading.html">upgrade documentation</a>.</p>
                <h3 id="downloading-lme">Downloading LME:</h3>
                <p>The following steps assume you&#39;re starting from a downloaded or cloned directory of LME on your
                    Ubuntu 22.04
                    server.</p>
                <p>We suggest you install the latest release version of LME using the following commands: </p>
                <p><b>1. Install Requirements</b></p>
                <pre><code>sudo apt update &amp;&amp; sudo apt install curl jq unzip -y
</code></pre>
                <p><b>2. Download and Unzip the latest version of LME</b>
                    This will add a path to ~/LME with all required files.</p>
                <pre><code>curl -s https://api.github.com/repos/cisagov/LME/releases/latest | jq -r &#39;.assets[0].browser_download_url&#39; | xargs -I {} sh -c &#39;curl -L -O {} &amp;&amp; unzip -d ~/LME $(basename {})&#39;
</code></pre>
                <p>Developer Note: if you&#39;re looking to develop LME, its suggested you <code>git clone</code> rather
                    than
                    downloading, please see our <a href="#developer-notes">DEV docs</a></p>
                <h3 id="configuration">Configuration</h3>
                <p>The configuration files are located in /config/. These steps will guide you through setting up LME
                </p>
                <p><b>1. Certificates and Passwords</b></p>
                <ul>
                    <li>instances.yml defines the certificates to be created.</li>
                    <li>Shell scripts will initialize accounts and generate certificates. They run from the quadlet
                        definitions
                        lme-setup-accts and lme-setup-certs.</li>
                </ul>
                <p><b>2. Podman Quadlet Configuration</b></p>
                <ul>
                    <li>Quadlet configuration for containers is located in /quadlet/. These map to the root systemd unit
                        files but
                        execute as non-privileged users.</li>
                </ul>
                <p><b>3. Environment Variables</b></p>
                <ul>
                    <li>Only edit the /config/lme-environment.env file to set required environment variables.</li>
                </ul>
                <p>*<b>USER REQUIRED EDITS</b>:*
                    The only file users needs to touch is creating <code>/config/lme-environment.env</code>, which sets
                    up the required
                    environment variables.</p>
                <p>This should be the IP address that your agents will use to connect to this server.</p>
                <p>Get your IP address via the following command: </p>
                <pre><code>hostname -I | awk &#39;{print $1}&#39;
</code></pre>
                <p>Setup the config via the following steps:</p>
                <pre><code>#change directory to ~/LME or whatever your download directory is above
cd ~/LME 
cp ./config/example.env ./config/lme-environment.env
</code></pre>
                <p>In the new <code>lme-environment.env</code> file, update the following values:</p>
                <pre><code>#your host ip as found from the above command
IPVAR=127.0.0.1 #your hosts ip 
</code></pre>
                <h3 id="automated-install"><b>Automated Install</b></h3>
                <p>You can run this Ansible installer for a fully automated install. </p>
                <pre><code class="language-bash">sudo apt update &amp;&amp; sudo apt install -y ansible
# cd ~/LME/lme-2-arch # Or path to your clone of this repo
ansible-playbook ./ansible/install_lme_local.yml
</code></pre>
                <p>This assumes that you have the repo in <code>~/LME/</code>. </p>
                <p>If you don&#39;t, you can pass the <code>CLONE_DIRECTORY</code> variable to the playbook. </p>
                <pre><code class="language-bash">ansible-playbook ./ansible/install_lme_local.yml -e &quot;clone_dir=/path/to/clone/directory&quot; 
</code></pre>
                <p><b>If you have issues accessing a file or directory, please note permissions and notes on folder
                        structure <a href="#notes-on-folders-permissions-and-service">here</a></b></p>
                <p>This also assumes your user can sudo without a password. If you need to input a password when you
                    sudo, you can run
                    it with the <code>-K</code> flag and it will prompt you for a password. </p>
                <pre><code class="language-bash">ansible-playbook -K ./ansible/install_lme_local.yml -e &quot;clone_dir=/path/to/clone/directory&quot; 
</code></pre>
                <p>In the <code>BECOME password</code> prompt enter the password for your user you would normally give
                    <code>sudo</code>, so the playbook is able to sudo as expected.
                </p>
                <h4 id="steps-performed-in-automated-install">Steps performed in automated install:</h4>
                <ol>
                    <li>Setup /opt/lme and check for sudo access. Configure other required directories/files.</li>
                    <li><b>Setup password information</b>: Configures the password vault and other
                        configuration for the
                        service user passwords. </li>
                    <li><b>Setup <a href="https://nixos.org/">Nix</a></b>: nix is the open source package
                        manager we use to
                        install the latest version of podman.</li>
                    <li><b>Set service user passwords</b>: Sets the service user passwords that are encrypted
                        according to the
                        <a href="/docs/markdown/reference/security-model.md">security model</a>.
                    </li>
                    <li><b>Install Quadlets</b>: Installs quadlet files in the directories described below to
                        be setup as
                        systemd services.</li>
                    <li><b>Setup Containers for root</b>: The containers listed in
                        <code>$clone_directory/config/containers.txt</code> will be pulled and tagged.
                    </li>
                    <li><b>Start lme.service</b>: Kicks off the start of LME service containers.</li>
                </ol>
                <p><b>Notes on folders, permissions, and service:</b></p>
                <ol>
                    <li>
                        <p><code>/opt/lme</code> will be owned by root, all LME services will run and execute as
                            unprivileged users. The
                            active LME configuration is stored in <code>/opt/lme/config</code>.
                            To access any file at <code>/opt/lme/</code> you&#39;ll need to make sure you&#39;re in a
                            root shell (e.g.
                            <code>sudo -i su</code>) or you run whatever command you&#39;re wanting to access in that
                            directory as root
                            (e.g. <code>sudo ls /opt/lme/config</code>)
                        </p>
                    </li>
                    <li>
                        <p>Other relevant directories are listed here:</p>
                    </li>
                </ol>
                <ul>
                    <li><code>/root/.config/containers/containers.conf</code>: LME will setup a custom podman
                        configuration for secrets
                        management via <a href="https://docs.ansible.com/ansible/latest/cli/ansible-vault.html">ansible
                            vault</a>.</li>
                    <li><code>/etc/lme</code>: storage directory for the master password and user password vault</li>
                    <li><code>/etc/lme/pass.sh</code>: the master password file</li>
                    <li><code>/etc/containers/systemd</code>: directory where LME installs its quadlet service files
                    </li>
                    <li><code>/etc/systemd/system</code>: directory where lme.service is installed</li>
                </ul>
                <ol start="3">
                    <li>
                        <p>The master password will be stored at <code>/etc/lme/pass.sh</code> and owned by root, while
                            service user
                            passwords will be stored at <code>/etc/lme/vault/</code></p>
                    </li>
                    <li>
                        <p>lme.service is a KICK START systemd service. It will always succeed and is designed so that
                            the other lme
                            services can be stopped and restarted by stopping/restarting lme.service.</p>
                    </li>
                </ol>
                <p>For example, to stop all of LME: </p>
                <pre><code class="language-bash">sudo -i systemctl stop lme.service
</code></pre>
                <p>To restart all of LME: </p>
                <pre><code class="language-bash">sudo -i systemctl restart lme.service
</code></pre>
                <p>To start all of LME:</p>
                <pre><code class="language-bash">sudo -i systemctl start lme.service
</code></pre>


            </div>


        </main>
        <footer>

        </footer>
    </div>
    </main>

</html>